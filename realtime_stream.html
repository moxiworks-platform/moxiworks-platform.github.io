<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>MoxiWorks Platform Realitme Stream Updates Documentation</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["json","csharp","ruby","php","http"]);
        });
      </script>
  </head>

  <body class="realtime_stream">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">JSON</a>
              <a href="#" data-language-name="csharp">.Net</a>
              <a href="#" data-language-name="ruby">Ruby</a>
              <a href="#" data-language-name="php">PHP</a>
              <a href="#" data-language-name="http">HTTP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul class="toc-footer" style="font-size: 18px">
          <li><a href='index.html'>Welcome</a></li>
          <li><a href='api.html'>MoxiCloud API</a></li>
          <li><a href='authentication.html'>Authentication Reference</a></li>
      </ul>
      <ul class="toc-footer" style="font-size: 18px; background-color: #494949">
        <li><a href='realtime_stream.html'>Realtime Stream Reference</a></li>
    </ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://moxiworks.com'>MoxiWorks!</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="moxiworks-realtime-stream-v2">MoxiWorks Realtime Stream V2</h1>

<h2 id="welcome">Welcome</h2>

<p>Welcome to the MoxiCloud Realtime Stream documentation. MoxiWorks Platform Realtime Stream Updates give you instant updates of MoxiCloud data. Once 
you have set up your integration, you will receive updates instantly as they are made in the MoxiCloud, giving you the ability to better serve your customers.  </p>

<p>In this section of the MoxiCloud Docs you&rsquo;ll find documentation about integrating with the MoxiWorks Realtime Update (PubSub) notifications.  </p>

<h2 id="getting-started">Getting Started</h2>

<p>Why choose MoxiWorks Platform Realtime Stream updates?</p>

<p>The following are reasons you might want to utilize MoxiWorks Realtime Stream updates:</p>

<p><span style="margin-left: -12px;">1) <strong>Instant Updates</strong></span>
<span>you get the data in your system as soon as a new listing/contact gets processed by our system. you have first access to new leads, new listings and new data because you&rsquo;re not waiting for system synchronization &ndash; it&rsquo;s always synchronized. This opens up a whole new range of product possibilities, giving you the ability to enhance your own product offerings and provide even better service to your clients.</span>
<div style="margin:20px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">2) <strong>Reduce Costs</strong></span>
Instead of bogging down systems while synchronizing data for thousands of records at once, your updates are inherently distributed, ensuring that your systems are always responsive and ready to meet your primary business needs.
<div style="margin:20px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">3) <strong>More Control</strong></span>
By piping your SNS feed to SQS or to your own internal queueing mechanism allows you the ability to process incoming changes at whatever rate you want. You and your systems control how much data you import at any given time and ensure that rate never causes resource contention issues.
<div style="margin:20px">&nbsp;</div></p>

<p>This documentation is intended to help you get you set up your MoxiWorks Platform Realtime Update Stream. </p>

<h3 id="getting-help">Getting Help</h3>

<p>During your integration process with MoxiCloud Realtime Stream, your MoxiWorks Platform representative will work with you on getting your Realtime Stream Updates working. If you have any questions about getting set up, please email <a href="mailto:partners@moxiworks.com">partners@moxiworks.com</a>.</p>

<h2 id="setting-up-for-updates">Setting Up For Updates</h2>

<h3 id="setup-using-an-aws-sns-topic">Setup Using An AWS SNS Topic</h3>

<p>The MoxiWorks Platform Realtime Stream currently offers updates using Amazon&rsquo;s <strong>Simple Notification Service</strong> (SNS). If you are interested in receiving <strong>MoxiWorks Realtime Stream Updates</strong> using a different method, please email <a href="mailto:partners@moxiworks.com">partners@moxiworks.com</a>.</p>

<h4 id="sns-configuring-for-moxiworks-platform-realtime-stream-updates">SNS: Configuring For MoxiWorks Platform Realtime Stream Updates</h4>

<p>In this section getting your Realtime Stream set up using SNS is covered. Use this to get your incoming <strong>MoxiWorks Realtime Stream Updates</strong> started. Once you&rsquo;ve set up your SNS feed to receive updates from the <strong>MoxiWorks Realtime Stream</strong> you can then configure handling of those messages to best serve your needs. You might configure <strong>MoxiWorks Realtime Stream Updates</strong> to be sent to your servers or to go to an SQS queue &ndash; ensuring you never miss an update. Combining MoxiWorks Realtime Stream Updates with Amazon SNS gives you the flexibility to handle incoming data any way that you need.</p>

<h5 id="creating-an-sns-topic-for-realtime-stream-updates">Creating an SNS Topic for Realtime Stream Updates</h5>

<aside class="warning">Your SNS topic must be created in the us-west-2 region.</aside>

<h5 id="overview">Overview</h5>

<p>To receive MoxiWorks Platform Realtime Stream Updates via SNS, first you&rsquo;ll need to create an SNS topic in your AWS Console and give permissions to MoxiWorks to publish to that SNS topic. This section goes over setting up your SNS Topic. Later, we&rsquo;ll go into getting data from your SNS Topic to your server.</p>

<blockquote>
<p><strong>SNS Topic Region</strong>: us-west-2</p>

<p><strong>Production MoxiWorks AWS User</strong>:  arn:aws:iam::689201434595:root</p>

<p><strong>QA/Staging MoxiWorks AWS User</strong>:  arn:aws:iam::063254003524:root</p>
</blockquote>

<h5 id="quickstart">Quickstart</h5>

<p>If you&rsquo;re familiar with setting up an SNS topic and giving permissions to a specific user for publishing to that topic, all you&rsquo;ll need to do is:</p>

<p>1) Give publishing permissions for your topic to the MoxiWorks Platform Stream User in AWS. The platform stream user ID is shown to the right for QA and production environments.</p>

<p>2)  Set up a subscription to receive incoming messages from that topic (HTTPS endpoint, SQS, etc.)</p>

<p>3) Please email <a href="mailto:partners@moxiworks.com">partners@moxiworks.com</a> and let us know what the SNS topic ARN is and whether the topic is for QA or production updates.</p>

<h5 id="sns-configuration-procedure">SNS Configuration Procedure</h5>

<p>If you need a little more help getting the SNS topic and subscription set up, we&rsquo;ve created an instructional procedure that you can follow. </p>

<aside class="note">Please note that although we will do our best to help support you through the process of setting up your MoxiWorks Platform Realtime Stream, we can not provide support for AWS based issues. </aside>

<p>To set up MoxiWorks Platform Realtime Stream SNS Topic using the AWS SNS Console use the following procedure. </p>

<p><span style="margin-left: -12px;">1) From your web browser, go to the Amazon SNS console at <a href="https://console.aws.amazon.com/sns/v3/home#/topics">console.aws.amazon.com</a>, to open the <strong>Amazon SNS Topics</strong> dashboard.</span>
<div style="margin:60px">&nbsp;</div></p>

<aside class="warning">Your SNS topic must be created in the us-west-2 region.</aside>

<p><span style="margin-left: -12px;">2) On the <strong>Amazon SNS Topics</strong> dashboard, click the <strong>Create topic</strong> button.</span></p>

<p><img src="images/create_topic_button.png" alt="AWS Create Topic Button" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">3) From the <strong>Details</strong> section of the <strong>Create topic</strong> interface, set the name of the topic. 
We recommend you utilize something that makes it clear that this is your <strong>MoxiWorks Platform Realtime Stream</strong>.</span></p>

<p><img src="images/set_topic_name.png" alt="AWS Create Topic Set Name" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">4) Click on the disclosure triangle to open the <strong>Access Policy</strong> section of the <strong>Create topic</strong> interface.</span></p>

<p><img src="images/access_policy.png" alt="AWS Console Create topic Access Policy Section" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">5) Ensure <strong>Basic</strong> method is selected.</span></p>

<p><img src="images/choose_method.png" alt="AWS Console Create topic Access Policy Choices" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-top: 45px;margin-bottom:8px;margin-left: -12px;">6) Under the <strong>Define who can publish messages to the topic</strong> section, click the <strong>Only the specified AWS accounts</strong> radio button.</span></p>

<p><img src="images/define_who_can_publish.png" alt="AWS Console SNS Define Who Can Publish Choices"  />
<div style="margin:60px">&nbsp;</div></p>

<blockquote>
<p><strong>MoxiWorks Platform Realtime Stream AWS Account ID (Production)</strong>:  689201434595</p>

<p><strong>MoxiWorks Platform Realtime Stream AWS Account ID (QA/Staging)</strong>:  063254003524</p>
</blockquote>

<p><span style="margin-left: -12px;">7) In the text area that appears, paste the MoxiWorks Platform Realtime Stream AWS Account ID: 
<strong>689201434595 (production) or 063254003524 (qa and staging)</strong></span></p>

<p><img src="images/only_specified_aws_accountsv2.png" alt="AWS Console SNS Define Who Can Publish Only Specified Account" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">8) Click the <strong>Create topic</strong> button to set up the topic. </span></p>

<p><img src="images/create_topic.png" alt="AWS Console Create topic Button" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">13) Click the Save changes button</span></p>

<p><img src="images/save_changes_button.png" alt="AWS Console Edit topic Save Changes Button" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">9) <strong>Let your MoxiWorks Platform Partner Services Representative know what the SNS topic ARN is and whether it is for QA or production updates.</strong></span></p>

<p><img src="images/ARN_example.png" alt="AWS Console ARN Example Location"  /></p>

<div style="margin:30px">&nbsp;</div>

<p>Once you&rsquo;ve completed this procedure, your Topic should now be ready to receive MoxiWorks Platform Realtime Stream Updates.</p>

<aside class="note">This procedure will ensure that your SNS topic gets Moxiworks Platform Realtime Stream Updates, but you&rsquo;ll still need to set up a place for SNS to send mesages to. That could be an SQS queue that you pull from as you have capacity, or it could be a direct feed to your own servers.</aside>

<h4 id="sns-receiving-updates">SNS: Receiving Updates</h4>

<p>In this section, we&rsquo;ll look at getting MoxiWorks Platform Realitime Stream Updates to your server; however, this is only one way that you might get data from SNS to your systems. You can investigate all the ways that you can integrate an SNS feed into your systems architecture via AWS help.</p>

<h5 id="configuring-an-sns-topic-to-send-updates-to-an-endpoint-via-http-or-https">Configuring an SNS Topic To Send Updates To An Endpoint via HTTP or HTTPS</h5>

<h5 id="overview">Overview</h5>

<p>To receive MoxiWorks Platform Realtime Stream Updates from SNS, you&rsquo;ll need to configure your SNS topic in your AWS Console to forward requests to your server. This section goes over setting up your SNS Topic to pass messages directly to your SNS enabled endpoint.</p>

<h5 id="quickstart">Quickstart</h5>

<p>If you&rsquo;re familiar with setting up SNS endpoints for data consumption, then all you&rsquo;ll need to do is:
1) Set up your SNS endpoint on your server.</p>

<p>2) Configure your SNS Topic to point to your server.</p>

<h5 id="sns-configuration-procedure">SNS Configuration Procedure</h5>

<p>If you need help in configuring your SNS Topic to deliver messages to your SNS enabled endpoint, we&rsquo;ve created this instructional procedure to help you.</p>

<aside class="note"> You&rsquo;ll need to set up and configure your endpoint to receive SNS notifications; however, setting up your SNS enabled endpoint is beyond the scope of this document. In this section, we only discuss configuration of SNS services via the AWS console. </aside>

<p>To set up your endpoint to receive MoxiWorks Platform Realtime Stream Updates via your SNS Topic, use the following procedure. </p>

<p><span style="margin-left: -12px;">1) From your web browser, go to the Amazon SNS console at <a href="https://console.aws.amazon.com/sns/v3/home#/topics">console.aws.amazon.com</a>, to open the <strong>Amazon SNS Topics</strong> dashboard.</span>
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">2) On the <strong>Amazon SNS Topics</strong> dashboard, click the SNS topic that is set up to receive messages.</span></p>

<p><img src="images/select_topic.png" alt="AWS Console Edit topic" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">3) From the SNS Topic&rsquo;s details page, click the <strong>Create subscription</strong> button.</span></p>

<p><img src="images/create_subscription.png" alt="AWS Console SNS Topic Details" />
<div style="margin:10px">&nbsp;</div></p>

<p><span>This will open the <strong>Create subscription</strong> interface.</span></p>

<div style="margin:60px">&nbsp;</div>

<p><span style="margin-left: -12px;">4) From the <strong>Details section</strong>, click the <strong>Protocol</strong> dropdown menu.</span></p>

<p><img src="images/subscription_protocol_dropdown.png" alt="AWS Console SNS Topic Subscription Protocol Dropwdown"  />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">5) Select the appropriate protocol for your incoming SNS messages.</span></p>

<p><img src="images/protocol_selections.png" alt="AWS Console SNS Topic Subscription Protocol Dropwdown Selections" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">6) If using <strong>HTTP</strong> or <strong>HTTPS</strong> as your protocol, set the URL of the endpoint which you expect to receive messages.</span></p>

<p><img src="images/http_endpoint_textfield.png" alt="AWS Console SNS Topic Subscription Endpoint Textfield" />
<div style="margin:60px">&nbsp;</div></p>

<p><span style="margin-left: -12px;">7) Click the <strong>Create subscription</strong> button to create the subscription. </span></p>

<p><img src="images/create_subscription_button.png" alt="AWS Console SNS Topic Subscription Create Button"/>
<div style="margin:60px">&nbsp;</div></p>

<h2 id="update-handling">Update Handling</h2>

<p><span>The MoxiWorks Platform Realtime Stream is designed to allow you to use the same parsing logic for both Realtime Stream Updates as well as MoxiCloud API calls. 
Except where noted below, data pushed via Realtime Updates should have have almost exactly shape as objects pulled via MoxiCloud API. Exceptions are noted in the <code class="prettyprint">Data Shape</code> 
sections below.</span></p>

<h4 id="payload-metadata">Payload Metadata</h4>

<p>Each message sent to your system by the MoxiWorks Platform Realtime Stream will have metadata associated with the object payload in the root level of the payload. In this section
we&rsquo;ll take a look at the metadata provided in the root level of the response.</p>

<blockquote><div class='highlight json' style="display: block">
<span class='data-example-label'><span class='entity-name'>Realtime Stream Update</span> Payload Metadata Example
</span></div></blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"/[agent|contact|listing|office|etc...]/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"action"</span><span class="p">:</span><span class="s2">"/[create|update|upsert|delete]/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:{</span><span class="w">
        </span><span class="err">...</span><span class="w">
    </span><span class="p">},</span><span class="w">
  </span><span class="nt">"last_updated"</span><span class="p">:</span><span class="w"> </span><span class="mi">1650050768</span><span class="p">,</span><span class="w">
  </span><span class="nt">"modification_timestamp"</span><span class="p">:</span><span class="s2">"2022-04-15T19:26:08.000+00:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"company_uuid"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234567</span><span class="p">,</span><span class="w">
  </span><span class="nt">"agent_uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"140a7944-bf51-4380-b61d-7ddd51b645f5"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"primary_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bfa7d824-f1da-475c-aeac-14270f471d45"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="realtime-stream-update-payload-metadata"><span class='entity-name'>Realtime Stream Update</span> Payload Metadata</h5>

<p><span>As previously noted, the payload of the data sent will (as close as possible) match the MoxiCloud API object shape. For example,  each Agent object will match the shape of the 
Agent that is provided via the MoxiCloud; however, the payload itself is wrapped in an outer scope that provides metadata about the update that would normally be implicitly scoped in a 
request to the MoxiCloud API. In orderto ensure that incoming updates are routed to the correct parsing logic, you&rsquo;ll need to inspect the metadata in the payload to determine the kind of 
update being sent and then route it to the correct logic for parsing and processing. </span></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><span class="required-data">last_updated</span></td>
<td><span class="required-data"><span class="data-type">Integer</span></span></td>
<td>Unix timestamp in full seconds of when data was updated, check that this payload is more recent than your copy before consuming</td>
</tr>
<tr>
<td><span class="required-data">modification_timestamp</span></td>
<td><span class="required-data"><span class="data-type">Integer</span></span></td>
<td>ISO8601 formatted timestamp of when data was updated, check that this payload is more recent than your copy before consuming</td>
</tr>
<tr>
<td><span class="required-data">type</span></td>
<td><span class="required-data"><span class="data-type">String</span></span></td>
<td>Enumerated set includes agent, contact, listing, office</td>
</tr>
<tr>
<td><span class="required-data">action</span></td>
<td><span class="required-data"><span class="data-type">String</span></span></td>
<td>Enumerated set includes create, update, upsert, delete</td>
</tr>
<tr>
<td><span class="required-data">data</span></td>
<td><span class="required-data"><span class="data-type">Object</span></span></td>
<td>Update Payload</td>
</tr>
<tr>
<td><span class="required-data">primary_id</span></td>
<td><span class="required-data"><span class="data-type">String</span></span></td>
<td>Primary identifier for object</td>
</tr>
<tr>
<td><span class="optional-data">agent_uuid</span></td>
<td><span class="optional-data"><span class="data-type">String</span></span></td>
<td>Optional</td>
</tr>
<tr>
<td><span class="optional-data">company_uuid</span></td>
<td><span class="optional-data"><span class="data-type">Integer</span></span></td>
<td>Optional</td>
</tr>
</tbody></table>

<p><span class="request-data-head">last_updated</span>
<span class="response-data-remarks">This is the Unix timestamp representing the date/time that this <span class='entity-name'>Realtime Stream Update</span> was updated. You should utilize the timestamp to ensure that no out-of-order updates occur.</span></p>

<p><span class="request-data-head">modification_timestamp</span>
<span class="response-data-remarks">This is the ISO8601 timestamp representing the date/time that this <span class='entity-name'>Realtime Stream Update</span> was updated. You can utilize the timestamp to ensure that no out-of-order updates occur.</span></p>

<aside class="note">Please note that although we will transmit every update in the order in which they occur on our systems, they may not arrive at your systems in the same order due to the architectural design of Amazon SNS. Please store either the last_updated or modification_timestamp along with your payload to ensure that only the latest data is received.  These timestamps can be used in requests against the MoxiCloud API to ensure all data is in sync.</aside>

<p><span class="request-data-head">type</span>
<span class="request-data-remarks">The type of entity update is in the payload of the message. this will be one of <span class='entity-name'>agent</span>, <span class='entity-name'>contact</span>, <span class='entity-name'>listing</span>  or <span class='entity-name'>office</span>.   </span></p>

<p><span class="request-data-head">action</span>
<span class="request-data-remarks">The action associated with the update. this will be one of <span class='entity-name'>create</span>, <span class='entity-name'>update</span>, <span class='entity-name'>upsert</span>  or <span class='entity-name'>delete</span>.   </span></p>

<p><span class="request-data-head">data</span>
<span class="request-data-remarks">A JSON object representing the entity in the MoxiCloud.</span></p>

<p><span class="request-data-head">primary_id</span>
<span class="request-data-remarks">The primary identifier for the object.  This can be used in subsequent calls to fetch the payload from the MoxiCloudAPI.</span></p>

<p><span class="request-data-head">agent_uuid</span>
<span class="request-data-remarks">Optional reference to an agent, provided only when entity is scoped to an agent.</span></p>

<p><span class="request-data-head">company_uuid</span>
<span class="request-data-remarks">Optional reference to a company, provided only when entity is scoped to a company</span></p>

<h2 id="update-types">Update Types</h2>

<p>The MoxiWorks Platform Realtime Stream currently provides updates for the following endpoints:<br/><br/>
<span class='entity-name'>Agent <a href="/api.html#agent">(Payload documentation)</a></span><br/>
<span class='entity-name'>Contact <a href="/api.html#contact">(Payload documentation)</a></span><br/>
<span class='entity-name'>Listing <a href="/api.html#listing">(Payload documentation)</a></span>
<br/><i style="background-color:#ffff66;padding:5px">  * Listing data will be sent in snake_case instead of UpperCamelCase (the default for listings in MoxiCloudAPI)</i><br/>
<span class='entity-name'>Office <a href="/api.html#office">(Payload documentation)</a></span><br/><br/></p>

<p>Please check back soon for additional supported endpoints.</p>


      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">JSON</a>
                <a href="#" data-language-name="csharp">.Net</a>
                <a href="#" data-language-name="ruby">Ruby</a>
                <a href="#" data-language-name="php">PHP</a>
                <a href="#" data-language-name="http">HTTP</a>
          </div>
      </div>
    </div>
  </body>
</html>
